<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RMF Remote Control</title>
    <style type="text/css" media="screen">
    body {
      margin:0;
      padding:0;
      background-color: black;
    }

    .joystick {
      margin: auto;
      display: block;
      width: 50%;
      margin-top: 30px;
    }
    </style>
  </head>
  <body id="body" onload="onBodyLoad()">
    <input type="range" min="-1024" max="1024" value="0" step="1" id="speed" class="joystick">

    <script>
        var ws = null;

        function addMessage(message) {
          console.log(message);
        }

        function sendSpeed(speed){
          var buf = new Int32Array(2);
          buf[0] = 1;
          buf[1] = speed;
          ws.send(buf);
        }
        
        function startSocket(){
          ws = new WebSocket('ws://'+document.location.host+'/ws',['arduino']);
          ws.binaryType = "arraybuffer";
          ws.onopen = function(e){
            addMessage("Connected");
          };
          ws.onclose = function(e){
            addMessage("Disconnected");
          };
          ws.onerror = function(e){
            console.log("ws error", e);
            addMessage("Error");
          };
          ws.onmessage = function(e){
            var msg = "";
            if(e.data instanceof ArrayBuffer){
              msg = "BIN:";
              var bytes = new Uint8Array(e.data);
              for (var i = 0; i < bytes.length; i++) {
                msg += String.fromCharCode(bytes[i]);
              }
            } else {
              msg = "TXT:"+e.data;
            }
            addMessage(msg);
          };
        }

        startSocket();


      const speedElement = document.getElementById('speed');
      speedElement.addEventListener('input', value => {
        sendSpeed(speedElement.value);
      });
    </script>
  </body>
</html>
